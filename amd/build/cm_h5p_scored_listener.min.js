define("local_dynprogressbar/cm_h5p_scored_listener",["exports","./repository"],(function(_exports,_repository){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Theme LearnR - JS code cm_h5p_scored_listener
   *
   * @module     local_dynprogressbar/cm_h5p_scored_listener
   * @copyright  2023 Tina John <tina.john@th-luebeck.de>
   * @copyright  Institut fuer interaktive Systeme der TH LÃ¼beck
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let registered=!1;_exports.init=()=>{if(registered)return;registered=!0;const handleXAPIEvent=function(event){if(event&&event.data&&event.data.statement&&event.data.statement.result&&event.data.statement.result.score&&event.data.statement.result.score.scaled){console.log("--externalDispatcher-handleXAPIEvent-",event);var cmcompletedEvent=new CustomEvent("cmcompleted",{detail:{message:"a course module completed or scored"}});document.dispatchEvent(cmcompletedEvent);const theiframe=this.frameElement;setTimeout((function(){hideCompletionInfo(theiframe)}),300)}};const hideCompletionInfo=async eventtarget=>{console.log("eventtarget",eventtarget);var element=eventtarget.closest("li > div");const cmid=(liidelement=>{var courseid;const matches=liidelement.getAttribute("id").match(/module-(\d+)/);if(matches)return courseid=matches[0].split("-")[1],console.log("cmid------",courseid),courseid})(eventtarget.closest("li")),course_id=function(){const bodyTag=document.getElementsByTagName("body")[0];var courseid;return bodyTag.getAttributeNames().forEach((attribute=>{const matches=bodyTag.getAttribute(attribute).match(/course-(\d+)/);if(matches){const courseNumber=matches[0];return courseid=courseNumber.split("-")[1],console.log("Coursenumber------",courseid),courseid}})),courseid||!1}(),response=await(0,_repository.getActivityInformationInnerHTML)(course_id,cmid);return window.console.log("getActivityInformationInnerHTML----response",response.innerHTML),(element=element.querySelector('div[data-region="activity-information"]')).innerHTML=response.innerHTML,!0};window.addEventListener("message",(function(e){console.log("---got mail from iframe---",e.data),e.data&&e.data.context&&"h5p"==e.data.context&&"hello"==e.data.action&&function(){if(window.document.h5player&&window.document.h5player.H5P&&window.document.h5player.H5P.externalDispatcher){console.log("dynprogressbar--externalDispatcher-single-gefunden-aka_docready-");var h5pextlDispatcher=window.document.h5player.H5P.externalDispatcher;window.document.h5player.H5P.externalDispatcher.off("xAPI"),window.document.h5player.H5P.externalDispatcher.on("xAPI",(function(event){if(event&&event.data&&event.data.statement&&event.data.statement.result&&event.data.statement.result.score&&event.data.statement.result.score.scaled){console.log("dynprogressbar--externalDispatcher-single--",event);var cmcompletedEvent=new CustomEvent("cmcompleted",{detail:{message:"a course module completed or scored"}});document.dispatchEvent(cmcompletedEvent),hideCompletionInfo(window.document)}}))}else for(var i=0;i<window.length;i++){var currentWindow=window[i];(h5pextlDispatcher=currentWindow.H5P.externalDispatcher)?(console.log("dynprogressbar---found h5p in window ---",h5pextlDispatcher),currentWindow.H5P.externalDispatcher.off("xAPI"),currentWindow.H5P.externalDispatcher.on("xAPI",handleXAPIEvent.bind(currentWindow))):console.log("dynprogressbar--h5playerElement not found")}}(),"h5p"==e.data.context&&"H5PembedIncore_send_core_xapi_statement_post"==e.data.action&&console.log("H5PembedIncore_send_core_xapi_statement_post---received->--addProgressFromCoreData---------")}))}}));

//# sourceMappingURL=cm_h5p_scored_listener.min.js.map