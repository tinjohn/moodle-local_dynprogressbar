define("local_dynprogressbar/dynprbar",["exports","./repository","./cm_h5p_scored_listener","./cm_man_compl_toggle"],(function(_exports,_repository,_cm_h5p_scored_listener,_cm_man_compl_toggle){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.changeProgressbarNGame=_exports.changeProgressbar=_exports.changeProgressPercentage=_exports.changeGAME=_exports.addProgressFromCoreData=void 0;_exports.addProgressFromCoreData=async()=>{const prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0],spanElement=document.querySelector("strong.progress-bar-num"),user_id=prbar.getAttribute("userid"),course_id=prbar.getAttribute("courseid"),response=await(0,_repository.getActivityCompletion)(user_id,course_id);if(window.console.log("getActivityCompletion----response",response),response&&response.statuses&&Array.isArray(response.statuses)){let count=0,countall=0;response.statuses.forEach((status=>{status.state>0&&count++,countall++}));var newwidth=Math.round(count/countall*100);prbar.style.width=newwidth+"%",spanElement.innerHTML=newwidth+"%"}};function getCourseIdFromBody(){const bodyTag=document.getElementsByTagName("body")[0];var courseid;return bodyTag.getAttributeNames().forEach((attribute=>{const matches=bodyTag.getAttribute(attribute).match(/course-(\d+)/);if(matches){const courseNumber=matches[0];return courseid=courseNumber.split("-")[1],console.log("Coursenumber------",courseid),courseid}})),courseid||!1}_exports.changeProgressPercentage=async()=>{const prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0],spanElement=document.querySelector("strong.progress-bar-num"),course_id=prbar.getAttribute("courseid"),response=await(0,_repository.getProgressPercentage)(course_id);if(response&&response.progress){response.warnings.length>0&&console.log("Warnings:",response.warnings),window.console.log("getProgressPercentage----response",response);var newwidth=response.progress;prbar.style.width=newwidth+"%",spanElement.innerHTML=newwidth+"%"}else console.log("no completion detected")};const changeProgressbar=async()=>{const course_id=getCourseIdFromBody();if(course_id){var response=await(0,_repository.get_theme_learnr_Progressbar_InnerHTML)(course_id);if(response&&response.innerHTML){window.console.log("get_theme_learnr_Progressbar_InnerHTML----response",response);var innerHTML=response.innerHTML;var elementToReplace=document.getElementsByClassName("progress courseview")[0];const newElement=document.createElement("div");newElement.innerHTML=innerHTML;elementToReplace.parentNode.replaceChild(newElement,elementToReplace)}else console.log("no progressbar update available");return!0}return console.log("no course id detected"),!1};_exports.changeProgressbar=changeProgressbar;_exports.changeProgressbarNGame=async()=>{const course_id=getCourseIdFromBody();if(course_id){var response;if((response=await(0,_repository.get_theme_learnr_Progressbar_InnerHTML)(course_id))&&response.innerHTML){window.console.log("get_theme_learnr_Progressbar_InnerHTML----response",response);var innerHTML=response.innerHTML;var elementToReplace=document.getElementsByClassName("progress courseview")[0];const newElement=document.createElement("div");newElement.innerHTML=innerHTML;elementToReplace.parentNode.replaceChild(newElement,elementToReplace)}else console.log("no progressbar update available");if((response=await(0,_repository.get_block_Game_InnerHTML)(course_id))&&response.innerHTML){window.console.log("get_block_Game_InnerHTML----response",response);innerHTML=response.innerHTML;const elementToReplaceGAME=document.getElementsByClassName("gameTable")[0].parentNode,newElementGAME=document.createElement("div");newElementGAME.innerHTML=innerHTML;elementToReplaceGAME.parentNode.replaceChild(newElementGAME,elementToReplaceGAME)}else console.log("no game update possible"),window.console.log("get_block_Game_InnerHTML----response",response);return!0}return console.log("no course id detected"),!1};const changeGAME=async()=>{const course_id=getCourseIdFromBody();if(course_id){var response=await(0,_repository.get_block_Game_InnerHTML)(course_id);if(response&&response.innerHTML){window.console.log("get_block_Game_InnerHTML----response",response);var innerHTML=response.innerHTML;const elementToReplaceGAME=document.getElementsByClassName("gameTable")[0].parentNode,newElementGAME=document.createElement("div");newElementGAME.innerHTML=innerHTML;elementToReplaceGAME.parentNode.replaceChild(newElementGAME,elementToReplaceGAME)}else console.log("no game update possible"),window.console.log("get_block_Game_InnerHTML----response",response);return!0}return console.log("no course id detected"),!1};_exports.changeGAME=changeGAME;const dynprbar_action=changeProgressbar,game_action=changeGAME,complinfo_action=async event=>{if(window.console.log("--changeCompletionInfo--event",event),event&&event.detail)if(event.detail.completionType&&"H5Pscored"==event.detail.completionType)if(event.detail.framedin){const eventtarget=event.detail.framedin;console.log("eventtarget",eventtarget);var element=eventtarget.closest("li > div");const cmid=(liidelement=>{var courseid;const matches=liidelement.getAttribute("id").match(/module-(\d+)/);if(matches)return courseid=matches[0].split("-")[1],console.log("cmid------",courseid),courseid})(eventtarget.closest("li")),course_id=getCourseIdFromBody(),response=await(0,_repository.get_H5P_ActivityInformation_InnerHTML)(course_id,cmid);window.console.log("get_H5P_ActivityInformation_InnerHTML----response",response),(element=element.querySelector('div[data-region="activity-information"]')).innerHTML=response.innerHTML}else window.console.log("no DOM for ActivityInformation in event");else window.console.log("no H5Pscored completionType in event");return!0};_exports.init=()=>{var prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0];console.log("prbarneusrc"+prbar),prbar?(console.log("dynprogressbar----load listener"),(0,_cm_h5p_scored_listener.init)(),(0,_cm_man_compl_toggle.init)()):console.log("dynprogressbar----no listeners loaded due to missing prbar"),window.addEventListener("load",(function(){var prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0];console.log("prbarneusrc"+prbar),document.addEventListener("cmcompleted",(function(event){console.log("cmcompleted----Custom event triggered:",event.detail.message),setTimeout((function(){dynprbar_action(),complinfo_action(event),game_action()}),300)}))}))}}));

//# sourceMappingURL=dynprbar.min.js.map